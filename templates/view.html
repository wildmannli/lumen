{{ define "view.html" }}
{{ template "meta_head" . }}
{{ template "header" . }}

<div class="max-w-5xl mx-auto h-full flex flex-col gap-6">

    {{ if .ShowAdminLink }}
    <div class="bg-neutral-900/30 border border-neutral-700 rounded-lg p-5 animate-fade-in">
        <div class="flex items-center gap-2 mb-4">
            <div class="w-1.5 h-1.5 rounded-full bg-white"></div>
            <h3 class="text-white font-medium text-sm tracking-tight">Paste Published</h3>
        </div>
        <div class="flex flex-col gap-3">
            <div>
                <p class="text-neutral-500 text-xs mb-1.5 uppercase tracking-wider font-semibold">Share Link</p>
                <div class="bg-black border border-neutral-700 rounded px-4 py-2.5 font-mono text-xs text-neutral-300 select-all break-all leading-relaxed">{{ .PasteURL }}</div>
            </div>
            <div>
                <p class="text-neutral-500 text-xs mb-1.5 uppercase tracking-wider font-semibold">Delete Link</p>
                <div class="bg-black border border-neutral-700 rounded px-4 py-2.5 font-mono text-xs text-neutral-500 select-all break-all leading-relaxed">{{ .DeleteURL }}</div>
            </div>
        </div>
    </div>
    {{ end }}

    {{ if .BurnWarning }}
    <div class="bg-black border border-white rounded p-4 text-center">
        <p class="text-white font-bold text-sm flex items-center justify-center gap-2 tracking-tight">
            <img src="/static/icons/fire.png" alt="Fire" class="w-4 h-4 invert">
            Self-Destruct Active
        </p>
        <p class="text-neutral-400 text-xs mt-1">This paste will be permanently deleted once you navigate away from this
            page.</p>
    </div>
    {{ end }}

    <div class="flex flex-col md:flex-row md:items-end justify-between gap-4 border-b border-neutral-700 pb-6">
        <div>
            <h1 class="text-2xl md:text-3xl font-bold text-white tracking-tight mb-2">
                {{ if .Paste.Title }}{{ .Paste.Title }}{{ else }}Untitled Paste{{ end }}
            </h1>
            <div class="flex flex-wrap items-center gap-4 text-xs text-neutral-500 font-mono uppercase tracking-wide">
                <span class="bg-neutral-900 text-neutral-400 px-2 py-0.5 rounded border border-neutral-700">{{ .Paste.ID
                    }}</span>
                <span>{{ .Paste.Views }} Views</span>
                <span>{{ .Paste.CreatedAt.Format "Jan 02 • 15:04" }}</span>
                {{ if not .BurnWarning }}
                <span>Expires in {{ .Paste.ExpiresIn }}</span>
                {{ end }}
                {{ if .Paste.IsPasswordProtected }}
                <span class="text-neutral-300 flex items-center gap-1">
                    <img src="/static/icons/lock.png" alt="Lock" class="w-3 h-3 opacity-80 invert">
                    Encrypted
                </span>
                {{ end }}
            </div>
        </div>

        <div class="flex gap-3">
            {{ if not .Paste.BurnAfterReading }}
            {{ if not .Paste.IsPasswordProtected }}
            <a href="/p/{{ .Paste.ID }}/fork"
                class="px-4 py-2 text-xs font-semibold text-neutral-300 border border-neutral-700 hover:border-white hover:text-white rounded-md transition-colors bg-black">
                FORK
            </a>
            <a href="/p/{{ .Paste.ID }}/download"
                class="px-4 py-2 text-xs font-semibold text-neutral-300 border border-neutral-700 hover:border-white hover:text-white rounded-md transition-colors bg-black">
                DOWNLOAD
            </a>
            <a href="/p/{{ .Paste.ID }}/raw"
                class="px-4 py-2 text-xs font-semibold text-neutral-300 border border-neutral-700 hover:border-white hover:text-white rounded-md transition-colors bg-black">
                RAW
            </a>
            {{ end }}
            {{ end }}
            <a href="/"
                class="px-4 py-2 text-xs font-semibold bg-white text-black rounded-md hover:bg-neutral-200 transition-colors">
                NEW PASTE
            </a>
        </div>
    </div>

    <!-- CSS-only tab switching via hidden radio inputs -->
    <article class="relative w-full view-tabs">
        <input type="radio" name="view-tab" id="tab-preview" class="view-tab-input" checked>
        <input type="radio" name="view-tab" id="tab-source" class="view-tab-input">

        <div class="flex border-b border-neutral-700">
            <label for="tab-preview" class="view-tab-label view-tab-label-preview">Preview</label>
            <label for="tab-source" class="view-tab-label view-tab-label-source">Source{{ if .Language }} · {{ .Language }}{{ end }}</label>
        </div>

        <div class="relative bg-[#111] border border-neutral-700 border-t-0 rounded-b-lg overflow-hidden">
            <div class="view-panel-preview">
                <div class="p-6 prose prose-invert max-w-none">
                    {{ safeHTML .RenderedContent }}
                </div>
            </div>

            <div class="view-panel-source">
                {{ if .HighlightedSource }}
                <div class="overflow-x-auto highlight-source">
                    {{ safeHTML .HighlightedSource }}
                </div>
                {{ else }}
                <div class="overflow-x-auto">
                    <table class="line-table font-mono text-sm leading-relaxed">
                        {{ $lines := splitLines .RawContent }}
                        {{ range $i, $line := $lines }}
                        <tr class="hover:bg-white/[0.02]">
                            <td class="select-none text-right text-neutral-600 text-xs px-4 py-0 border-r border-neutral-800 align-top w-1 whitespace-nowrap">{{ add $i 1 }}</td>
                            <td class="text-neutral-300 px-4 py-0 whitespace-pre">{{ $line }}</td>
                        </tr>
                        {{ end }}
                    </table>
                </div>
                {{ end }}
            </div>
        </div>
    </article>

</div>

{{ template "footer" . }}
{{ end }}
